<div class="container-fluid mt-4">
  <h2 class="mb-4">ðŸ’¼ Case Management Dashboard</h2>

  <!-- Filters -->
  <div class="row mb-3">
    <div class="col-md-4">
      <label for="investigator-filter" class="form-label">Filter by Investigator:</label>
      <select id="investigator-filter" class="form-select" (change)="updateInvestigatorFilter($event)">
        <option value="ALL">All Investigators</option>
        <option *ngFor="let inv of availableInvestigators" [value]="inv.id">{{ inv.name }}</option>
      </select>
    </div>

    <div class="col-md-4">
      <label for="status-filter" class="form-label">Filter by Status:</label>
      <select id="status-filter" class="form-select" (change)="updateStatusFilter($event)">
        <option value="ALL">All Status</option>
        <option *ngFor="let status of availableStatuses" [value]="status">{{ status }}</option>
      </select>
    </div>
  </div>

  <!-- Table -->
  <div class="table-responsive">
    <table class="table table-striped table-hover table-bordered align-middle">
      <thead class="table-dark">
        <tr>
          <th>Case ID</th>
          <th>Claim ID</th>
          <th>Investigator</th>
          <th>Status</th>
          <th>Resolution Notes</th>
          <th>Is Fraud</th>
          <th class="text-center">Action</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let caseItem of filteredCases$ | async">
          <!-- Display Mode -->
          <ng-container *ngIf="editingCaseId !== caseItem.id">
            <td>{{ caseItem.caseID }}</td>
            <td>{{ caseItem.claimID }}</td>
            <td>{{ getInvestigatorName(caseItem.investigatorID) }}</td>
            <td>
              <span 
                class="badge"
                [ngClass]="{
                  'bg-success': caseItem.status === CASE_STATUS.COMPLETED,
                  'bg-warning text-dark': caseItem.status === CASE_STATUS.PENDING,
                  'bg-danger': caseItem.status === CASE_STATUS.OPEN
                }"
              >
                {{ caseItem.status }}
              </span>
            </td>
            <td class="notes-column">{{ caseItem.resolutionNotes }}</td>
            <td>
              <span class="badge" [ngClass]="caseItem.isFraud ? 'bg-danger' : 'bg-primary'">
                {{ caseItem.isFraud ? 'YES' : 'NO' }}
              </span>
            </td>
            <td class="text-center">
              <button class="btn btn-sm btn-info text-white" (click)="startEdit(caseItem)">
                <i class="bi bi-pencil-square"></i> Edit
              </button>
            </td>
          </ng-container>

          <!-- Edit Mode -->
          <ng-container *ngIf="editingCaseId === caseItem.id">
            <td>{{ caseItem.id }}</td>
            <td>{{ caseItem.claimID }}</td>

            <td>
              <select class="form-select form-select-sm" [(ngModel)]="investigatorInput">
                <option [value]="null">Unassigned</option>
                <option *ngFor="let inv of availableInvestigators" [value]="inv.id">{{ inv.name }}</option>
              </select>
            </td>

            <td>
              <select class="form-select form-select-sm" [(ngModel)]="statusInput">
                <option *ngFor="let status of availableStatuses" [value]="status">{{ status }}</option>
              </select>
            </td>

            <td>
              <textarea class="form-control form-control-sm" [(ngModel)]="resolutionNotesInput"></textarea>
            </td>

            <td class="text-center">
              <input type="checkbox" class="form-check-input" [(ngModel)]="isFraudInput">
            </td>

            <td class="text-center">
              <button class="btn btn-sm btn-success me-1" (click)="saveEdit()">Save</button>
              <button class="btn btn-sm btn-secondary" (click)="cancelEdit()">Cancel</button>
            </td>
          </ng-container>
        </tr>

        <tr *ngIf="(filteredCases$ | async)?.length === 0">
          <td colspan="7" class="text-center">No cases found for the selected filters.</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
